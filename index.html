<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å½©è™¹ç‹å›½ - å›¾è…¾è¿çº¿æŠ½å¥–</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
            font-family: 'PingFang SC', 'Helvetica Neue', Arial, sans-serif;
        }
        
        html, body {
            width: 100%;
            height: 100%;
            overflow-x: hidden;
            -webkit-text-size-adjust: 100%;
            -moz-text-size-adjust: 100%;
            -ms-text-size-adjust: 100%;
            text-size-adjust: 100%;
        }
        
        body {
            background: linear-gradient(135deg, #0c0c2e 0%, #1a1a4a 100%);
            color: #fff;
            position: relative;
            padding: 0;
            min-height: 100vh;
        }
        
        /* ç¦æ­¢é•¿æŒ‰å¤åˆ¶ */
        * {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        /* é˜²æ­¢IOSç‚¹å‡»å»¶è¿Ÿ */
        * {
            -webkit-touch-callout: none;
        }
        
        .container {
            width: 100%;
            max-width: 480px;
            margin: 0 auto;
            padding: 10px 15px 80px;
            min-height: 100vh;
        }
        
        /* é¡¶éƒ¨åŒºåŸŸ */
        .header-area {
            position: sticky;
            top: 0;
            z-index: 100;
            background: rgba(12, 12, 46, 0.95);
            backdrop-filter: blur(10px);
            padding: 10px 0;
            margin: -10px -15px 15px;
            padding-left: 15px;
            padding-right: 15px;
            border-bottom: 1px solid rgba(122, 95, 255, 0.2);
        }
        
        .logo {
            font-size: 1.8rem;
            color: #ff4d94;
            text-shadow: 0 0 10px rgba(255, 77, 148, 0.7);
            margin-bottom: 5px;
            text-align: center;
        }
        
        .title {
            font-size: 1.2rem;
            background: linear-gradient(90deg, #ff4d94, #7a5fff);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 5px;
            text-align: center;
            line-height: 1.3;
        }
        
        .subtitle {
            font-size: 0.75rem;
            color: #a0a0ff;
            text-align: center;
            line-height: 1.2;
            margin-bottom: 5px;
        }
        
        /* è´§å¸åŒºåŸŸ */
        .currency-top-bar {
            display: flex;
            justify-content: space-between;
            margin: 10px 0 15px;
            gap: 10px;
        }
        
        .currency-item {
            flex: 1;
            background: rgba(40, 40, 90, 0.8);
            border-radius: 12px;
            padding: 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.2);
        }
        
        .currency-info {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .currency-icon {
            font-size: 1.5rem;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .gem-icon {
            background: linear-gradient(135deg, #ff4d94, #ff7a5f);
            color: white;
        }
        
        .diamond-icon {
            background: linear-gradient(135deg, #7a5fff, #4d9dff);
            color: white;
        }
        
        .currency-details {
            display: flex;
            flex-direction: column;
        }
        
        .currency-count {
            font-size: 1.3rem;
            font-weight: bold;
            color: #fff;
            line-height: 1.2;
        }
        
        .currency-label {
            font-size: 0.7rem;
            color: #a0a0ff;
        }
        
        .add-currency-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(135deg, #4dffb8, #00cc88);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s ease;
            box-shadow: 0 3px 8px rgba(77, 255, 184, 0.4);
        }
        
        .add-currency-btn:active {
            transform: scale(0.95);
            box-shadow: 0 1px 5px rgba(77, 255, 184, 0.6);
        }
        
        .add-currency-btn.diamond-btn {
            background: linear-gradient(135deg, #7a5fff, #4d9dff);
        }
        
        /* ä¸»æ¸¸æˆåŒºåŸŸ */
        .main-game-area {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        
        .panel {
            background: rgba(30, 30, 70, 0.9);
            border-radius: 16px;
            padding: 18px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(100, 100, 255, 0.15);
            backdrop-filter: blur(5px);
        }
        
        .section-title {
            font-size: 1.1rem;
            color: #7a5fff;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 1px solid rgba(122, 95, 255, 0.3);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .section-title i {
            font-size: 1rem;
        }
        
        /* å›¾è…¾ç½‘æ ¼ */
        .totem-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            grid-gap: 6px;
            margin: 15px 0;
        }
        
        .totem-cell {
            aspect-ratio: 1/1;
            background: rgba(40, 40, 90, 0.7);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
            touch-action: manipulation;
        }
        
        .totem-cell:active {
            transform: scale(0.95);
        }
        
        .totem-cell.active {
            background: linear-gradient(135deg, #7a5fff, #ff4d94);
            box-shadow: 0 0 15px rgba(122, 95, 255, 0.7);
            transform: scale(1.05);
        }
        
        /* è¿çº¿æç¤º */
        .lines-indicator {
            display: flex;
            justify-content: space-between;
            margin-top: 15px;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .line-type {
            display: flex;
            align-items: center;
            font-size: 0.8rem;
        }
        
        .line-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            margin-right: 5px;
        }
        
        .horizontal { background-color: #ff4d94; }
        .vertical { background-color: #7a5fff; }
        .diagonal { background-color: #4dffb8; }
        
        /* å¬å”¤æŒ‰é’®åŒºåŸŸ */
        .summon-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin: 15px 0;
        }
        
        .summon-btn {
            background: linear-gradient(135deg, #7a5fff, #ff4d94);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 18px 20px;
            font-size: 1.1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 5px 15px rgba(122, 95, 255, 0.4);
            touch-action: manipulation;
            position: relative;
            overflow: hidden;
        }
        
        .summon-btn:active {
            transform: translateY(2px);
            box-shadow: 0 2px 8px rgba(122, 95, 255, 0.6);
        }
        
        .summon-btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
            opacity: 0.7;
        }
        
        .summon-btn::after {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: linear-gradient(to right, transparent, rgba(255, 255, 255, 0.1), transparent);
            transform: rotate(30deg);
            transition: transform 0.5s;
        }
        
        .summon-btn:hover::after {
            transform: rotate(30deg) translate(50%, 50%);
        }
        
        /* ç»Ÿè®¡ä¿¡æ¯ */
        .stats-container {
            margin: 15px 0;
            padding: 15px;
            background: rgba(40, 40, 90, 0.5);
            border-radius: 12px;
            border-left: 4px solid #4dffb8;
        }
        
        .stats-title {
            font-size: 0.95rem;
            color: #4dffb8;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .stats-content {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }
        
        .stat-item {
            display: flex;
            flex-direction: column;
        }
        
        .stat-label {
            font-size: 0.75rem;
            color: #a0a0ff;
            margin-bottom: 3px;
        }
        
        .stat-value {
            font-size: 1.1rem;
            color: #fff;
            font-weight: bold;
        }
        
        /* è¿›åº¦æ¡ */
        .progress-container {
            margin: 15px 0;
        }
        
        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9rem;
        }
        
        .progress-bar {
            height: 10px;
            background-color: rgba(50, 50, 100, 0.5);
            border-radius: 5px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff4d94, #7a5fff);
            border-radius: 5px;
            width: 0%;
            transition: width 0.5s ease;
        }
        
        /* ä»»åŠ¡åˆ—è¡¨ */
        .tasks-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .task-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 14px;
            background: rgba(50, 50, 100, 0.5);
            border-radius: 12px;
            transition: all 0.2s ease;
            touch-action: manipulation;
        }
        
        .task-item:active {
            background: rgba(50, 50, 100, 0.8);
            transform: scale(0.98);
        }
        
        .task-info h4 {
            font-size: 0.95rem;
            margin-bottom: 4px;
        }
        
        .task-info p {
            font-size: 0.8rem;
            color: #a0a0ff;
        }
        
        .task-reward {
            display: flex;
            align-items: center;
            color: #4dffb8;
            font-weight: bold;
            font-size: 0.9rem;
        }
        
        .task-reward i {
            margin-right: 5px;
        }
        
        .task-complete {
            background: rgba(77, 255, 184, 0.2);
            border-left: 4px solid #4dffb8;
        }
        
        /* è§„åˆ™é¢æ¿ */
        .rules-list {
            padding-left: 18px;
        }
        
        .rules-list li {
            margin-bottom: 10px;
            line-height: 1.4;
            color: #d0d0ff;
            font-size: 0.85rem;
        }
        
        /* åº•éƒ¨å¯¼èˆª */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(20, 20, 50, 0.98);
            display: flex;
            justify-content: space-around;
            padding: 12px 0;
            border-top: 1px solid rgba(122, 95, 255, 0.3);
            backdrop-filter: blur(10px);
            z-index: 1000;
        }
        
        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: #a0a0ff;
            cursor: pointer;
            transition: all 0.2s ease;
            touch-action: manipulation;
            padding: 5px 10px;
            border-radius: 10px;
            min-width: 60px;
        }
        
        .nav-item:active {
            background: rgba(122, 95, 255, 0.2);
            transform: scale(0.95);
        }
        
        .nav-item.active {
            color: #7a5fff;
            background: rgba(122, 95, 255, 0.1);
        }
        
        .nav-item i {
            font-size: 1.3rem;
            margin-bottom: 5px;
        }
        
        .nav-item span {
            font-size: 0.75rem;
        }
        
        /* å¼¹çª— */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.9);
            z-index: 2000;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .modal-content {
            background: linear-gradient(135deg, #1a1a4a, #0c0c2e);
            width: 100%;
            max-width: 400px;
            border-radius: 20px;
            padding: 25px;
            text-align: center;
            border: 2px solid #7a5fff;
            box-shadow: 0 0 30px rgba(122, 95, 255, 0.7);
            animation: modalAppear 0.4s ease;
            max-height: 85vh;
            overflow-y: auto;
        }
        
        @keyframes modalAppear {
            from { transform: translateY(50px) scale(0.9); opacity: 0; }
            to { transform: translateY(0) scale(1); opacity: 1; }
        }
        
        .reward-icon {
            font-size: 3.5rem;
            color: #ff4d94;
            margin: 15px 0;
        }
        
        .reward-title {
            font-size: 1.5rem;
            color: #4dffb8;
            margin-bottom: 10px;
            line-height: 1.3;
        }
        
        .reward-desc {
            color: #d0d0ff;
            margin-bottom: 20px;
            line-height: 1.5;
            font-size: 0.95rem;
        }
        
        .close-modal {
            background: #7a5fff;
            color: white;
            border: none;
            border-radius: 50px;
            padding: 14px 30px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            width: 100%;
            max-width: 200px;
            margin: 0 auto;
            display: block;
            touch-action: manipulation;
        }
        
        .close-modal:active {
            transform: scale(0.95);
            background: #6a4fff;
        }
        
        /* æ¦‚ç‡è¡¨æ ¼ */
        .probability-table {
            width: 100%;
            margin: 15px 0;
            border-collapse: collapse;
            font-size: 0.8rem;
        }
        
        .probability-table th {
            background: rgba(122, 95, 255, 0.3);
            padding: 10px 8px;
            text-align: left;
            color: #ff4d94;
        }
        
        .probability-table td {
            padding: 8px;
            border-bottom: 1px solid rgba(122, 95, 255, 0.2);
            color: #d0d0ff;
        }
        
        .probability-table tr:last-child td {
            border-bottom: none;
        }
        
        .probability-table .percent {
            color: #4dffb8;
            font-weight: bold;
        }
        
        .probability-table .amount {
            color: #ffb84d;
        }
        
        /* è·å–å®çŸ³å¼¹çª— */
        .gem-options {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin: 15px 0;
        }
        
        .gem-option {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: rgba(40, 40, 90, 0.5);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s ease;
            touch-action: manipulation;
        }
        
        .gem-option:active {
            background: rgba(40, 40, 90, 0.8);
            transform: scale(0.98);
        }
        
        .gem-option-info {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .gem-option-icon {
            font-size: 1.5rem;
            color: #ff4d94;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background: rgba(255, 77, 148, 0.1);
            border-radius: 10px;
        }
        
        .gem-option-reward {
            color: #4dffb8;
            font-weight: bold;
            font-size: 1.1rem;
        }
        
        .gem-option.bulk-option {
            background: linear-gradient(135deg, rgba(255, 77, 148, 0.3), rgba(255, 122, 95, 0.3));
            border: 2px solid #ff4d94;
        }
        
        /* æ‰¹é‡å¢åŠ å®çŸ³æŒ‰é’® */
        .bulk-gem-btn-container {
            margin-top: 15px;
        }
        
        .bulk-gem-btn {
            background: linear-gradient(135deg, #ff4d94, #ff7a5f);
            color: white;
            border: none;
            border-radius: 50px;
            padding: 16px 20px;
            font-size: 1rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            box-shadow: 0 5px 15px rgba(255, 77, 148, 0.4);
            width: 100%;
            touch-action: manipulation;
        }
        
        .bulk-gem-btn:active {
            transform: scale(0.95);
            box-shadow: 0 2px 8px rgba(255, 77, 148, 0.6);
        }
        
        /* å¢åŠ é’»çŸ³é€‰é¡¹ */
        .diamond-options {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin: 15px 0;
        }
        
        .diamond-option {
            background: rgba(40, 40, 90, 0.5);
            border-radius: 12px;
            padding: 15px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
            border: 2px solid transparent;
            touch-action: manipulation;
        }
        
        .diamond-option:active {
            background: rgba(40, 40, 90, 0.8);
            border-color: #7a5fff;
            transform: scale(0.95);
        }
        
        .diamond-option-icon {
            font-size: 1.8rem;
            color: #4d9dff;
            margin-bottom: 8px;
        }
        
        .diamond-option-amount {
            font-size: 1rem;
            color: #4dffb8;
            font-weight: bold;
            margin-bottom: 5px;
        }
        
        .diamond-option-desc {
            font-size: 0.75rem;
            color: #a0a0ff;
        }
        
        /* æŠ½å¥–ç»“æœ */
        .lottery-prize {
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 15px 0;
            padding: 20px;
            background: rgba(40, 40, 90, 0.5);
            border-radius: 15px;
            border: 2px solid #7a5fff;
            flex-direction: column;
            text-align: center;
        }
        
        .lottery-prize-icon {
            font-size: 2.5rem;
            color: #ff4d94;
            margin-bottom: 10px;
        }
        
        .lottery-prize-info h3 {
            font-size: 1.3rem;
            color: #4dffb8;
            margin-bottom: 5px;
        }
        
        .lottery-prize-info p {
            color: #a0a0ff;
            font-size: 0.9rem;
        }
        
        /* æ»šåŠ¨æ¡æ ·å¼ */
        .modal-content::-webkit-scrollbar {
            width: 5px;
        }
        
        .modal-content::-webkit-scrollbar-track {
            background: rgba(40, 40, 90, 0.5);
            border-radius: 10px;
        }
        
        .modal-content::-webkit-scrollbar-thumb {
            background: #7a5fff;
            border-radius: 10px;
        }
        
        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 380px) {
            .container {
                padding: 8px 12px 80px;
            }
            
            .totem-grid {
                grid-gap: 4px;
            }
            
            .totem-cell {
                font-size: 1.3rem;
            }
            
            .currency-top-bar {
                flex-direction: column;
            }
            
            .diamond-options {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .stats-content {
                grid-template-columns: 1fr;
            }
            
            .summon-btn {
                padding: 16px 15px;
                font-size: 1rem;
            }
        }
        
        /* æ¨ªå±é€‚é… */
        @media (max-height: 500px) and (orientation: landscape) {
            .container {
                padding-bottom: 60px;
            }
            
            .bottom-nav {
                padding: 8px 0;
            }
            
            .nav-item i {
                font-size: 1.1rem;
                margin-bottom: 3px;
            }
            
            .nav-item span {
                font-size: 0.7rem;
            }
            
            .totem-grid {
                grid-gap: 4px;
            }
            
            .totem-cell {
                font-size: 1.2rem;
            }
        }
        
        /* é€‚é…iPhone XåŠä»¥ä¸Š */
        @supports (padding: max(0px)) {
            .container {
                padding-left: max(15px, env(safe-area-inset-left));
                padding-right: max(15px, env(safe-area-inset-right));
                padding-bottom: max(80px, env(safe-area-inset-bottom) + 60px);
            }
            
            .bottom-nav {
                padding-bottom: max(12px, env(safe-area-inset-bottom));
                padding-left: env(safe-area-inset-left);
                padding-right: env(safe-area-inset-right);
            }
            
            .header-area {
                padding-top: max(10px, env(safe-area-inset-top));
                padding-left: max(15px, env(safe-area-inset-left));
                padding-right: max(15px, env(safe-area-inset-right));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¡¶éƒ¨åŒºåŸŸ -->
        <div class="header-area">
            <div class="logo">ğŸŒˆ å½©è™¹ç‹å›½</div>
            <h1 class="title">å¬å”¤ç‚¹äº®å›¾è…¾è¿çº¿æ‹¿å¤§å¥–</h1>
            <p class="subtitle">æ¯æ¬¡å¬å”¤å‡æœ‰æœºä¼šè·å¾—ã€å›¾è…¾å¥–åŠ±ã€‘</p>
        </div>
        
        <!-- è´§å¸åŒºåŸŸ -->
        <div class="currency-top-bar">
            <div class="currency-item">
                <div class="currency-info">
                    <div class="currency-icon gem-icon">
                        <i class="fas fa-gem"></i>
                    </div>
                    <div class="currency-details">
                        <div class="currency-count" id="gemCount">50</div>
                        <div class="currency-label">å®çŸ³</div>
                    </div>
                </div>
                <button class="add-currency-btn" id="addGemsBtn">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
            
            <div class="currency-item">
                <div class="currency-info">
                    <div class="currency-icon diamond-icon">
                        <i class="fas fa-diamond"></i>
                    </div>
                    <div class="currency-details">
                        <div class="currency-count" id="diamondCount">100</div>
                        <div class="currency-label">é’»çŸ³</div>
                    </div>
                </div>
                <button class="add-currency-btn diamond-btn" id="addDiamondsBtn">
                    <i class="fas fa-plus"></i>
                </button>
            </div>
        </div>
        
        <!-- æ‰¹é‡å¢åŠ å®çŸ³æŒ‰é’® -->
        <div class="bulk-gem-btn-container">
            <button class="bulk-gem-btn" id="addBulkGemsBtn">
                <i class="fas fa-bolt"></i>
                ä¸€é”®å¢åŠ 1000å®çŸ³
            </button>
        </div>
        
        <div class="main-game-area">
            <!-- å›¾è…¾è¿çº¿åŒºåŸŸ -->
            <div class="panel">
                <h2 class="section-title">
                    <i class="fas fa-th-large"></i>
                    å›¾è…¾è¿çº¿
                </h2>
                
                <div class="totem-grid" id="totemGrid">
                    <!-- å›¾è…¾ç½‘æ ¼é€šè¿‡JSç”Ÿæˆ -->
                </div>
                
                <div class="lines-indicator">
                    <div class="line-type">
                        <div class="line-dot horizontal"></div>
                        <span>æ¨ªçº¿5è¿</span>
                    </div>
                    <div class="line-type">
                        <div class="line-dot vertical"></div>
                        <span>ç«–çº¿5è¿</span>
                    </div>
                    <div class="line-type">
                        <div class="line-dot diagonal"></div>
                        <span>æ–œçº¿5è¿</span>
                    </div>
                </div>
            </div>
            
            <!-- å¬å”¤åŒºåŸŸ -->
            <div class="panel">
                <h2 class="section-title">
                    <i class="fas fa-star"></i>
                    å¬å”¤å›¾è…¾
                </h2>
                
                <div class="summon-buttons">
                    <button class="summon-btn" id="summonOne">
                        <i class="fas fa-star"></i>
                        å¬å”¤ä¸€æ¬¡ (2å®çŸ³)
                    </button>
                    <button class="summon-btn" id="summonTen">
                        <i class="fas fa-star"></i>
                        å¬å”¤åæ¬¡ (20å®çŸ³)
                    </button>
                </div>
                
                <!-- å®çŸ³ä½¿ç”¨ç»Ÿè®¡ -->
                <div class="stats-container">
                    <div class="stats-title">
                        <i class="fas fa-chart-bar"></i>
                        å®çŸ³ä½¿ç”¨ç»Ÿè®¡
                    </div>
                    <div class="stats-content">
                        <div class="stat-item">
                            <div class="stat-label">ä»Šæ—¥æ¶ˆè€—</div>
                            <div class="stat-value" id="todayUsed">0</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">ç´¯è®¡æ¶ˆè€—</div>
                            <div class="stat-value" id="totalUsed">0</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">å•æ¬¡å¬å”¤</div>
                            <div class="stat-value" id="singleSummon">0</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-label">åè¿å¬å”¤</div>
                            <div class="stat-value" id="tenSummon">0</div>
                        </div>
                    </div>
                </div>
                
                <div class="progress-container">
                    <div class="progress-label">
                        <span>ä»Šæ—¥è¿çº¿è¿›åº¦</span>
                        <span id="progressText">0/5</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                </div>
            </div>
            
            <!-- ä»»åŠ¡åˆ—è¡¨ -->
            <div class="panel">
                <h2 class="section-title">
                    <i class="fas fa-tasks"></i>
                    ä»»åŠ¡åˆ—è¡¨
                </h2>
                
                <div class="tasks-list" id="tasksList">
                    <!-- ä»»åŠ¡é€šè¿‡JSç”Ÿæˆ -->
                </div>
            </div>
            
            <!-- æ´»åŠ¨è§„åˆ™ -->
            <div class="panel">
                <h2 class="section-title">
                    <i class="fas fa-info-circle"></i>
                    æ´»åŠ¨è§„åˆ™
                </h2>
                
                <ul class="rules-list">
                    <li>æ¶ˆè€—å®çŸ³å¯éšæœºç‚¹äº®å›¾è…¾ï¼Œæ¯ç‚¹äº®ä¸€ä¸ªå›¾è…¾å¯è·å¾—å›¾è…¾å¥–åŠ±ï¼Œå½“ç‚¹äº®çš„å›¾è…¾æ¨ªã€ç«–ã€æ–œ5ä¸ªè¿çº¿æˆåŠŸå¿…å¾—å¯¹åº”å¤§å¥–ï¼›</li>
                    <li>æˆåŠŸè¿çº¿ä¹‹å‰ï¼Œå›¾è…¾ä¸ä¼šè¢«é‡å¤ç‚¹äº®ï¼Œè¿çº¿æˆåŠŸåï¼Œæ‰€æœ‰ç‚¹äº®çš„å›¾è…¾å°†è¢«é‡ç½®ï¼›</li>
                    <li>è¿çº¿æˆåŠŸåï¼Œå°†æ ¹æ®æ¦‚ç‡è¡¨è¿›è¡ŒæŠ½å¥–ï¼Œè·å¾—é¢å¤–å¥–åŠ±ï¼›</li>
                    <li>åˆ†äº«æ´»åŠ¨é¡µé¢ã€åœ¨æˆ¿é—´åœç•™5åˆ†é’Ÿï¼Œå……å€¼ä»»æ„é‡‘é¢ä»»åŠ¡è·å¾—å®çŸ³æ—¥ä¸Šé™1æ¬¡ï¼Œæ”¶ç¤¼ä»»åŠ¡è·å¾—å®çŸ³æ— ä¸Šé™ï¼›</li>
                    <li>æ´»åŠ¨ç»“æŸæ—¶ï¼Œæœªæ¶ˆè€—çš„å®çŸ³å°†æ¸…ç©ºå¤±æ•ˆï¼Œè¯·æ‚¨åœ¨æ´»åŠ¨æœŸé—´åŠæ—¶ä½¿ç”¨ï¼›</li>
                </ul>
            </div>
        </div>
    </div>
    
    <!-- å¥–åŠ±å¼¹çª— -->
    <div class="modal" id="rewardModal">
        <div class="modal-content">
            <div class="reward-icon">
                <i class="fas fa-gift"></i>
            </div>
            <h2 class="reward-title" id="rewardTitle">è¿çº¿æˆåŠŸï¼</h2>
            <p class="reward-desc" id="rewardDesc">æ­å–œæ‚¨æˆåŠŸå®Œæˆå›¾è…¾è¿çº¿ï¼Œè·å¾—è¶…çº§å¤§å¥–ï¼</p>
            <button class="close-modal" id="closeModal">é¢†å–å¥–åŠ±</button>
        </div>
    </div>
    
    <!-- æŠ½å¥–å¼¹çª— -->
    <div class="modal" id="lotteryModal">
        <div class="modal-content">
            <div class="reward-icon">
                <i class="fas fa-trophy"></i>
            </div>
            <h2 class="reward-title">è¿çº¿æˆåŠŸæŠ½å¥–</h2>
            <p class="reward-desc">æ­å–œå®Œæˆè¿çº¿ï¼æ ¹æ®æ¦‚ç‡è¡¨æŠ½ä¸­ä»¥ä¸‹å¥–åŠ±ï¼š</p>
            
            <div class="lottery-prize" id="lotteryPrize">
                <!-- æŠ½å¥–ç»“æœé€šè¿‡JSç”Ÿæˆ -->
            </div>
            
            <button class="close-modal" id="closeLotteryModal">é¢†å–å¥–åŠ±</button>
        </div>
    </div>
    
    <!-- è·å–å®çŸ³å¼¹çª— -->
    <div class="modal" id="gemModal">
        <div class="modal-content">
            <div class="reward-icon">
                <i class="fas fa-gem"></i>
            </div>
            <h2 class="reward-title">è·å–å®çŸ³</h2>
            <p class="reward-desc">é€‰æ‹©ä»¥ä¸‹æ–¹å¼è·å–æ›´å¤šå®çŸ³</p>
            
            <div class="gem-options" id="gemOptions">
                <!-- å®çŸ³è·å–é€‰é¡¹é€šè¿‡JSç”Ÿæˆ -->
            </div>
            
            <button class="close-modal" id="closeGemModal">å…³é—­</button>
        </div>
    </div>
    
    <!-- å¢åŠ é’»çŸ³å¼¹çª— -->
    <div class="modal" id="diamondModal">
        <div class="modal-content">
            <div class="reward-icon">
                <i class="fas fa-diamond"></i>
            </div>
            <h2 class="reward-title">å¢åŠ é’»çŸ³</h2>
            <p class="reward-desc">é€‰æ‹©è¦å¢åŠ çš„é’»çŸ³æ•°é‡</p>
            
            <div class="diamond-options">
                <div class="diamond-option" data-amount="10">
                    <div class="diamond-option-icon">
                        <i class="fas fa-diamond"></i>
                    </div>
                    <div class="diamond-option-amount">+10 é’»çŸ³</div>
                    <div class="diamond-option-desc">å…è´¹è·å¾—</div>
                </div>
                <div class="diamond-option" data-amount="100">
                    <div class="diamond-option-icon">
                        <i class="fas fa-diamond"></i>
                    </div>
                    <div class="diamond-option-amount">+100 é’»çŸ³</div>
                    <div class="diamond-option-desc">è§‚çœ‹å¹¿å‘Š</div>
                </div>
                <div class="diamond-option" data-amount="1000">
                    <div class="diamond-option-icon">
                        <i class="fas fa-diamond"></i>
                    </div>
                    <div class="diamond-option-amount">+1000 é’»çŸ³</div>
                    <div class="diamond-option-desc">å®Œæˆæˆå°±</div>
                </div>
            </div>
            
            <button class="close-modal" id="closeDiamondModal">å…³é—­</button>
        </div>
    </div>
    
    <!-- æ¦‚ç‡è¡¨å¼¹çª— -->
    <div class="modal" id="probabilityModal">
        <div class="modal-content">
            <div class="reward-icon">
                <i class="fas fa-percentage"></i>
            </div>
            <h2 class="reward-title">æŠ½å¥–æ¦‚ç‡è¡¨</h2>
            
            <table class="probability-table">
                <thead>
                    <tr>
                        <th>é¡¹ç›®</th>
                        <th>é‡‘é¢</th>
                        <th>å æ¯”</th>
                    </tr>
                </thead>
                <tbody id="probabilityTable">
                    <!-- æ¦‚ç‡è¡¨é€šè¿‡JSç”Ÿæˆ -->
                </tbody>
            </table>
            
            <button class="close-modal" id="closeProbabilityModal">å…³é—­</button>
        </div>
    </div>
    
    <!-- åº•éƒ¨å¯¼èˆª -->
    <div class="bottom-nav">
        <div class="nav-item active" data-page="home">
            <i class="fas fa-home"></i>
            <span>é¦–é¡µ</span>
        </div>
        <div class="nav-item" data-page="rules">
            <i class="fas fa-list-alt"></i>
            <span>è§„åˆ™</span>
        </div>
        <div class="nav-item" data-page="probability">
            <i class="fas fa-percentage"></i>
            <span>æ¦‚ç‡</span>
        </div>
        <div class="nav-item" data-page="rank">
            <i class="fas fa-chart-bar"></i>
            <span>æ¦œå•</span>
        </div>
        <div class="nav-item" data-page="reward">
            <i class="fas fa-award"></i>
            <span>å¥–åŠ±</span>
        </div>
    </div>

    <script>
        // æ¸¸æˆçŠ¶æ€
        const gameState = {
            gems: 50,
            diamonds: 100,
            activeCells: new Set(),
            lineCount: 0,
            // ç»Ÿè®¡ä¿¡æ¯
            stats: {
                todayUsed: 0,      // ä»Šæ—¥æ¶ˆè€—å®çŸ³
                totalUsed: 0,      // ç´¯è®¡æ¶ˆè€—å®çŸ³
                singleSummon: 0,   // å•æ¬¡å¬å”¤æ¬¡æ•°
                tenSummon: 0       // åè¿å¬å”¤æ¬¡æ•°
            },
            tasks: [
                { id: 1, name: "åˆ†äº«æ´»åŠ¨é¡µé¢", desc: "æ¯æ—¥ä¸Šé™1æ¬¡", reward: 5, completed: false, daily: true },
                { id: 2, name: "åœ¨æˆ¿é—´åœç•™5åˆ†é’Ÿ", desc: "æ¯æ—¥ä¸Šé™1æ¬¡", reward: 5, completed: false, daily: true },
                { id: 3, name: "å……å€¼ä»»æ„é‡‘é¢", desc: "æ¯æ—¥ä¸Šé™1æ¬¡", reward: 10, completed: false, daily: true },
                { id: 4, name: "æ”¶ç¤¼è¾¾åˆ°100", desc: "æ— ä¸Šé™", reward: 15, completed: false, daily: false }
            ],
            // å®çŸ³è·å–é€‰é¡¹
            gemOptions: [
                { id: 1, name: "è§‚çœ‹å¹¿å‘Š", icon: "fas fa-tv", reward: 3, desc: "è§‚çœ‹30ç§’å¹¿å‘Š" },
                { id: 2, name: "æ¯æ—¥ç™»å½•", icon: "fas fa-calendar-day", reward: 5, desc: "æ¯æ—¥é¦–æ¬¡ç™»å½•" },
                { id: 3, name: "é‚€è¯·å¥½å‹", icon: "fas fa-user-plus", reward: 10, desc: "æˆåŠŸé‚€è¯·1ä½å¥½å‹" },
                { id: 4, name: "åˆ†äº«åˆ°æœ‹å‹åœˆ", icon: "fas fa-share-alt", reward: 8, desc: "åˆ†äº«æ´»åŠ¨åˆ°ç¤¾äº¤å¹³å°" },
                { id: 5, name: "å®Œæˆæ–°æ‰‹æ•™ç¨‹", icon: "fas fa-graduation-cap", reward: 20, desc: "é¦–æ¬¡å®Œæˆæ•™ç¨‹" },
                { id: 6, name: "è¿ç»­ç™»å½•7å¤©", icon: "fas fa-award", reward: 50, desc: "è¿ç»­ç™»å½•å¥–åŠ±" },
                { id: 7, name: "ä¸€æ¬¡æ€§è·å–", icon: "fas fa-bolt", reward: 1000, desc: "ç›´æ¥è·å–1000å®çŸ³", bulk: true }
            ],
            // æŠ½å¥–æ¦‚ç‡è¡¨
            lotteryPrizes: [
                { name: "ä¸€ç›’æƒŠå–œ", amount: "1660", probability: "11.00%" },
                { name: "å°å…”è§‚æœˆ", amount: "1660", probability: "6.50%" },
                { name: "é£å±‹ç¯æ¸¸", amount: "2880", probability: "5.00%" },
                { name: "çˆ±ä¸½ä¸å¹»å¢ƒ", amount: "4880", probability: "2.00%" },
                { name: "æœˆä¸‹é²¸æ¢¦æˆ’", amount: "6660", probability: "1.00%" },
                { name: "å¤ªé˜³å¥³ç¥å¤´åƒæ¡†*1å¤©", amount: "800", probability: "7.00%" },
                { name: "å¤§è¾£æ¡", amount: "800", probability: "6.50%" },
                { name: "å°å…”å‘ç®", amount: "400", probability: "10.00%" },
                { name: "å—ç“œå°æ€ª", amount: "400", probability: "15.00%" },
                { name: "åœŸç¥å…½", amount: "600", probability: "14.00%" },
                { name: "æŸ æª¬ç‰©è¯­", amount: "1000", probability: "11.00%" },
                { name: "å¿ƒåŠ¨æ¥ä¿¡", amount: "1000", probability: "11.00%" }
            ],
            // å¯èƒ½çš„å›¾è…¾å›¾æ ‡
            totemIcons: ["ğŸ‰", "ğŸ¦…", "ğŸº", "ğŸ¦Œ", "ğŸ", "ğŸ¦", "ğŸ¦…", "ğŸ»", "ğŸ¦‰", "ğŸ¬"],
            // å¤§å¥–åˆ—è¡¨
            rewards: [
                "7å¤©è±ªåä¼šå‘˜",
                "é™å®šå¤´åƒæ¡†",
                "500é’»çŸ³",
                "è¶…çº§ç¤¼ç‰©åŒ…",
                "ä¸“å±ç§°å·",
                "ç¥ç§˜å®ç®±",
                "é«˜çº§åéª‘",
                "ä¼ è¯´çš®è‚¤"
            ]
        };

        // DOMå…ƒç´ 
        const gemCountElement = document.getElementById('gemCount');
        const diamondCountElement = document.getElementById('diamondCount');
        const totemGrid = document.getElementById('totemGrid');
        const tasksList = document.getElementById('tasksList');
        const summonOneBtn = document.getElementById('summonOne');
        const summonTenBtn = document.getElementById('summonTen');
        const addGemsBtn = document.getElementById('addGemsBtn');
        const addBulkGemsBtn = document.getElementById('addBulkGemsBtn');
        const addDiamondsBtn = document.getElementById('addDiamondsBtn');
        const rewardModal = document.getElementById('rewardModal');
        const lotteryModal = document.getElementById('lotteryModal');
        const gemModal = document.getElementById('gemModal');
        const diamondModal = document.getElementById('diamondModal');
        const probabilityModal = document.getElementById('probabilityModal');
        const rewardTitle = document.getElementById('rewardTitle');
        const rewardDesc = document.getElementById('rewardDesc');
        const closeModalBtn = document.getElementById('closeModal');
        const closeLotteryModalBtn = document.getElementById('closeLotteryModal');
        const closeGemModalBtn = document.getElementById('closeGemModal');
        const closeDiamondModalBtn = document.getElementById('closeDiamondModal');
        const closeProbabilityModalBtn = document.getElementById('closeProbabilityModal');
        const progressText = document.getElementById('progressText');
        const progressFill = document.getElementById('progressFill');
        const gemOptions = document.getElementById('gemOptions');
        const lotteryPrize = document.getElementById('lotteryPrize');
        const probabilityTable = document.getElementById('probabilityTable');
        
        // ç»Ÿè®¡å…ƒç´ 
        const todayUsedElement = document.getElementById('todayUsed');
        const totalUsedElement = document.getElementById('totalUsed');
        const singleSummonElement = document.getElementById('singleSummon');
        const tenSummonElement = document.getElementById('tenSummon');

        // é¡µé¢åˆ‡æ¢
        let currentPage = 'home';

        // åˆå§‹åŒ–æ¸¸æˆ
        function initGame() {
            renderTotemGrid();
            renderTasks();
            renderGemOptions();
            renderProbabilityTable();
            updateCurrencyCount();
            updateStats();
            updateProgress();
            
            // äº‹ä»¶ç›‘å¬
            summonOneBtn.addEventListener('click', () => summonTotem(1));
            summonTenBtn.addEventListener('click', () => summonTotem(10));
            addGemsBtn.addEventListener('click', openGemModal);
            addBulkGemsBtn.addEventListener('click', () => getGems(7)); // 7æ˜¯æ‰¹é‡è·å–1000å®çŸ³çš„ID
            addDiamondsBtn.addEventListener('click', openDiamondModal);
            closeModalBtn.addEventListener('click', closeRewardModal);
            closeLotteryModalBtn.addEventListener('click', closeLotteryModal);
            closeGemModalBtn.addEventListener('click', closeGemModal);
            closeDiamondModalBtn.addEventListener('click', closeDiamondModal);
            closeProbabilityModalBtn.addEventListener('click', () => probabilityModal.style.display = 'none');
            
            // é’»çŸ³é€‰é¡¹ç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.diamond-option').forEach(option => {
                option.addEventListener('click', function() {
                    const amount = parseInt(this.dataset.amount);
                    addDiamonds(amount);
                });
            });
            
            // åº•éƒ¨å¯¼èˆªç‚¹å‡»äº‹ä»¶
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function() {
                    const page = this.dataset.page;
                    switchPage(page);
                });
            });
            
            // åˆå§‹åŒ–é¡µé¢
            switchPage('home');
        }

        // åˆ‡æ¢é¡µé¢
        function switchPage(page) {
            // æ›´æ–°å¯¼èˆªçŠ¶æ€
            document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
            document.querySelector(`.nav-item[data-page="${page}"]`).classList.add('active');
            
            // å…³é—­æ‰€æœ‰å¼¹çª—
            closeAllModals();
            
            // å¤„ç†é¡µé¢åˆ‡æ¢
            currentPage = page;
            switch(page) {
                case 'home':
                    // é¦–é¡µå·²æ˜¾ç¤ºï¼Œæ— éœ€æ“ä½œ
                    break;
                case 'rules':
                    // è§„åˆ™é¡µé¢å·²åœ¨ä¸»å†…å®¹ä¸­æ˜¾ç¤ºï¼Œæ»šåŠ¨åˆ°è§„åˆ™åŒºåŸŸ
                    document.querySelector('.panel:last-child').scrollIntoView({ behavior: 'smooth' });
                    break;
                case 'probability':
                    probabilityModal.style.display = 'flex';
                    break;
                case 'rank':
                    showReward("æ¦œå•åŠŸèƒ½", "æ¦œå•åŠŸèƒ½æ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼");
                    break;
                case 'reward':
                    showReward("å¥–åŠ±ä¸­å¿ƒ", "å¥–åŠ±ä¸­å¿ƒæ­£åœ¨å¼€å‘ä¸­ï¼Œæ•¬è¯·æœŸå¾…ï¼");
                    break;
            }
        }

        // å…³é—­æ‰€æœ‰å¼¹çª—
        function closeAllModals() {
            const modals = document.querySelectorAll('.modal');
            modals.forEach(modal => {
                modal.style.display = 'none';
            });
        }

        // æ¸²æŸ“å›¾è…¾ç½‘æ ¼
        function renderTotemGrid() {
            totemGrid.innerHTML = '';
            for (let i = 0; i < 25; i++) {
                const cell = document.createElement('div');
                cell.className = 'totem-cell';
                cell.dataset.index = i;
                
                // å¦‚æœæ ¼å­å·²æ¿€æ´»ï¼Œæ˜¾ç¤ºå›¾æ ‡
                if (gameState.activeCells.has(i)) {
                    cell.classList.add('active');
                    cell.textContent = gameState.totemIcons[i % gameState.totemIcons.length];
                }
                
                totemGrid.appendChild(cell);
            }
        }

        // æ¸²æŸ“ä»»åŠ¡åˆ—è¡¨
        function renderTasks() {
            tasksList.innerHTML = '';
            gameState.tasks.forEach(task => {
                const taskElement = document.createElement('div');
                taskElement.className = `task-item ${task.completed ? 'task-complete' : ''}`;
                taskElement.dataset.taskId = task.id;
                
                taskElement.innerHTML = `
                    <div class="task-info">
                        <h4>${task.name}</h4>
                        <p>${task.desc}</p>
                    </div>
                    <div class="task-reward">
                        <i class="fas fa-gem"></i>
                        <span>${task.reward}å®çŸ³</span>
                    </div>
                `;
                
                // ç‚¹å‡»å®Œæˆä»»åŠ¡
                if (!task.completed) {
                    taskElement.addEventListener('click', () => completeTask(task.id));
                }
                
                tasksList.appendChild(taskElement);
            });
        }

        // æ¸²æŸ“å®çŸ³è·å–é€‰é¡¹
        function renderGemOptions() {
            gemOptions.innerHTML = '';
            gameState.gemOptions.forEach(option => {
                const optionElement = document.createElement('div');
                optionElement.className = `gem-option ${option.bulk ? 'bulk-option' : ''}`;
                optionElement.dataset.id = option.id;
                
                optionElement.innerHTML = `
                    <div class="gem-option-info">
                        <div class="gem-option-icon">
                            <i class="${option.icon}"></i>
                        </div>
                        <div>
                            <h4>${option.name}</h4>
                            <p>${option.desc}</p>
                        </div>
                    </div>
                    <div class="gem-option-reward">
                        <i class="fas fa-gem"></i>
                        <span>+${option.reward}</span>
                    </div>
                `;
                
                // ç‚¹å‡»è·å–å®çŸ³
                optionElement.addEventListener('click', () => getGems(option.id));
                
                gemOptions.appendChild(optionElement);
            });
        }

        // æ¸²æŸ“æ¦‚ç‡è¡¨
        function renderProbabilityTable() {
            probabilityTable.innerHTML = '';
            gameState.lotteryPrizes.forEach(prize => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${prize.name}</td>
                    <td class="amount">${prize.amount}</td>
                    <td class="percent">${prize.probability}</td>
                `;
                probabilityTable.appendChild(row);
            });
        }

        // å¬å”¤å›¾è…¾
        function summonTotem(count) {
            const cost = count === 1 ? 2 : 20;
            
            // æ£€æŸ¥å®çŸ³æ˜¯å¦è¶³å¤Ÿ
            if (gameState.gems < cost) {
                showReward("å®çŸ³ä¸è¶³", "å®çŸ³ä¸è¶³ï¼Œè¯·ç‚¹å‡»ã€è·å–å®çŸ³ã€‘æŒ‰é’®è·å–æ›´å¤šå®çŸ³");
                return;
            }
            
            // æ‰£é™¤å®çŸ³
            gameState.gems -= cost;
            
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            if (count === 1) {
                gameState.stats.singleSummon++;
                gameState.stats.todayUsed += 2;
                gameState.stats.totalUsed += 2;
            } else {
                gameState.stats.tenSummon++;
                gameState.stats.todayUsed += 20;
                gameState.stats.totalUsed += 20;
            }
            
            updateCurrencyCount();
            updateStats();
            
            // éšæœºæ¿€æ´»å›¾è…¾æ ¼å­
            const availableCells = Array.from({length: 25}, (_, i) => i)
                .filter(i => !gameState.activeCells.has(i));
            
            if (availableCells.length === 0) {
                // æ‰€æœ‰æ ¼å­éƒ½å·²æ¿€æ´»ä½†æ²¡æœ‰è¿çº¿ï¼Œè‡ªåŠ¨é‡ç½®
                resetGrid();
                showReward("é‡ç½®", "æ‰€æœ‰å›¾è…¾å·²ç‚¹äº®ä½†æœªè¿çº¿ï¼Œå·²è‡ªåŠ¨é‡ç½®");
                summonTotem(count);
                return;
            }
            
            // éšæœºé€‰æ‹©æœªæ¿€æ´»çš„æ ¼å­
            const activatedCells = [];
            for (let i = 0; i < count && availableCells.length > 0; i++) {
                const randomIndex = Math.floor(Math.random() * availableCells.length);
                const cellIndex = availableCells[randomIndex];
                gameState.activeCells.add(cellIndex);
                activatedCells.push(cellIndex);
                availableCells.splice(randomIndex, 1);
            }
            
            // æ›´æ–°UI
            renderTotemGrid();
            
            // æ˜¾ç¤ºå¬å”¤ç»“æœ
            if (count === 1) {
                const rewardIndex = activatedCells[0] % gameState.totemIcons.length;
                showReward("å¬å”¤æˆåŠŸ", `è·å¾— ${gameState.totemIcons[rewardIndex]} å›¾è…¾ï¼Œæ¶ˆè€—2å®çŸ³`);
            } else {
                showReward("åè¿å¬å”¤", `æˆåŠŸæ¿€æ´» ${activatedCells.length} ä¸ªå›¾è…¾ï¼Œæ¶ˆè€—20å®çŸ³`);
            }
            
            // æ£€æŸ¥è¿çº¿
            checkLines();
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            updateButtonState();
        }

        // æ£€æŸ¥æ˜¯å¦æœ‰è¿çº¿
        function checkLines() {
            const lines = [];
            const activeArray = Array.from(gameState.activeCells);
            
            // æ£€æŸ¥æ¨ªçº¿
            for (let row = 0; row < 5; row++) {
                const line = [];
                for (let col = 0; col < 5; col++) {
                    const index = row * 5 + col;
                    line.push(gameState.activeCells.has(index));
                }
                if (line.every(cell => cell)) lines.push({type: "æ¨ªçº¿", cells: Array.from({length: 5}, (_, i) => row * 5 + i)});
            }
            
            // æ£€æŸ¥ç«–çº¿
            for (let col = 0; col < 5; col++) {
                const line = [];
                for (let row = 0; row < 5; row++) {
                    const index = row * 5 + col;
                    line.push(gameState.activeCells.has(index));
                }
                if (line.every(cell => cell)) lines.push({type: "ç«–çº¿", cells: Array.from({length: 5}, (_, i) => i * 5 + col)});
            }
            
            // æ£€æŸ¥ä¸»å¯¹è§’çº¿
            const mainDiagonal = [];
            for (let i = 0; i < 5; i++) {
                const index = i * 5 + i;
                mainDiagonal.push(gameState.activeCells.has(index));
            }
            if (mainDiagonal.every(cell => cell)) lines.push({type: "ä¸»å¯¹è§’çº¿", cells: Array.from({length: 5}, (_, i) => i * 5 + i)});
            
            // æ£€æŸ¥å‰¯å¯¹è§’çº¿
            const antiDiagonal = [];
            for (let i = 0; i < 5; i++) {
                const index = i * 5 + (4 - i);
                antiDiagonal.push(gameState.activeCells.has(index));
            }
            if (antiDiagonal.every(cell => cell)) lines.push({type: "å‰¯å¯¹è§’çº¿", cells: Array.from({length: 5}, (_, i) => i * 5 + (4 - i))});
            
            // å¦‚æœæœ‰è¿çº¿ï¼Œå¤„ç†å¥–åŠ±
            if (lines.length > 0) {
                gameState.lineCount += lines.length;
                updateProgress();
                
                // æ˜¾ç¤ºè¿çº¿å¥–åŠ±
                const line = lines[0];
                const reward = gameState.rewards[Math.floor(Math.random() * gameState.rewards.length)];
                showReward(`${line.type}è¿çº¿æˆåŠŸ`, `æ­å–œè·å¾—å¤§å¥–ï¼š${reward}ï¼æ‰€æœ‰å›¾è…¾å·²é‡ç½®`);
                
                // è§¦å‘æŠ½å¥–
                setTimeout(() => {
                    startLottery();
                }, 1500);
                
                // é‡ç½®ç½‘æ ¼
                setTimeout(() => {
                    resetGrid();
                }, 3000);
            }
        }

        // å¼€å§‹æŠ½å¥–
        function startLottery() {
            // æ ¹æ®æ¦‚ç‡è¡¨è¿›è¡ŒæŠ½å¥–
            // å°†æ¦‚ç‡è½¬æ¢ä¸ºæƒé‡
            const weights = gameState.lotteryPrizes.map(prize => {
                // å°†ç™¾åˆ†æ¯”è½¬æ¢ä¸ºæƒé‡ï¼ˆå»æ‰%å·ï¼Œè½¬æ¢ä¸ºæ•°å­—ï¼‰
                return parseFloat(prize.probability);
            });
            
            // è®¡ç®—æ€»æƒé‡
            const totalWeight = weights.reduce((sum, weight) => sum + weight, 0);
            
            // ç”Ÿæˆéšæœºæ•°
            let random = Math.random() * totalWeight;
            
            // æ ¹æ®æƒé‡é€‰æ‹©å¥–å“
            let selectedPrize = null;
            for (let i = 0; i < gameState.lotteryPrizes.length; i++) {
                random -= weights[i];
                if (random <= 0) {
                    selectedPrize = gameState.lotteryPrizes[i];
                    break;
                }
            }
            
            // å¦‚æœæ²¡æœ‰é€‰ä¸­å¥–å“ï¼ˆç†è®ºä¸Šä¸ä¼šå‘ç”Ÿï¼‰ï¼Œé€‰æ‹©ç¬¬ä¸€ä¸ª
            if (!selectedPrize) {
                selectedPrize = gameState.lotteryPrizes[0];
            }
            
            // æ˜¾ç¤ºæŠ½å¥–ç»“æœ
            showLotteryResult(selectedPrize);
        }

        // æ˜¾ç¤ºæŠ½å¥–ç»“æœ
        function showLotteryResult(prize) {
            // æ›´æ–°æŠ½å¥–ç»“æœæ˜¾ç¤º
            lotteryPrize.innerHTML = `
                <div class="lottery-prize-icon">
                    <i class="fas fa-gift"></i>
                </div>
                <div class="lottery-prize-info">
                    <h3>${prize.name}</h3>
                    <p>é‡‘é¢ï¼š${prize.amount} | æ¦‚ç‡ï¼š${prize.probability}</p>
                </div>
            `;
            
            // æ˜¾ç¤ºæŠ½å¥–å¼¹çª—
            lotteryModal.style.display = 'flex';
            
            // æ ¹æ®å¥–å“é‡‘é¢å¢åŠ é’»çŸ³
            const diamondAmount = Math.floor(parseInt(prize.amount) / 10);
            if (diamondAmount > 0) {
                gameState.diamonds += diamondAmount;
                updateCurrencyCount();
            }
        }

        // é‡ç½®å›¾è…¾ç½‘æ ¼
        function resetGrid() {
            gameState.activeCells.clear();
            renderTotemGrid();
            updateButtonState();
        }

        // å®Œæˆä»»åŠ¡
        function completeTask(taskId) {
            const task = gameState.tasks.find(t => t.id === taskId);
            if (!task || task.completed) return;
            
            task.completed = true;
            gameState.gems += task.reward;
            
            updateCurrencyCount();
            renderTasks();
            
            showReward("ä»»åŠ¡å®Œæˆ", `æˆåŠŸè·å¾—${task.reward}å®çŸ³`);
        }

        // è·å–å®çŸ³
        function getGems(optionId) {
            const option = gameState.gemOptions.find(o => o.id === optionId);
            if (!option) return;
            
            // å¢åŠ å®çŸ³
            gameState.gems += option.reward;
            updateCurrencyCount();
            
            // æ˜¾ç¤ºè·å¾—å®çŸ³æç¤º
            if (option.bulk) {
                showReward("è·å¾—å¤§é‡å®çŸ³", `æˆåŠŸä¸€æ¬¡æ€§è·å–${option.reward}å®çŸ³ï¼`);
            } else {
                showReward("è·å¾—å®çŸ³", `æˆåŠŸé€šè¿‡ã€${option.name}ã€‘è·å¾—${option.reward}å®çŸ³`);
            }
            
            // å…³é—­å®çŸ³å¼¹çª—
            closeGemModal();
        }

        // å¢åŠ é’»çŸ³
        function addDiamonds(amount) {
            // å¢åŠ é’»çŸ³
            gameState.diamonds += amount;
            updateCurrencyCount();
            
            // æ˜¾ç¤ºè·å¾—é’»çŸ³æç¤º
            showReward("è·å¾—é’»çŸ³", `æˆåŠŸè·å¾—${amount}é’»çŸ³`);
            
            // å…³é—­é’»çŸ³å¼¹çª—
            closeDiamondModal();
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯æ˜¾ç¤º
        function updateStats() {
            todayUsedElement.textContent = gameState.stats.todayUsed;
            totalUsedElement.textContent = gameState.stats.totalUsed;
            singleSummonElement.textContent = gameState.stats.singleSummon;
            tenSummonElement.textContent = gameState.stats.tenSummon;
        }

        // æ‰“å¼€å®çŸ³è·å–å¼¹çª—
        function openGemModal() {
            gemModal.style.display = 'flex';
        }

        // å…³é—­å®çŸ³è·å–å¼¹çª—
        function closeGemModal() {
            gemModal.style.display = 'none';
        }

        // æ‰“å¼€å¢åŠ é’»çŸ³å¼¹çª—
        function openDiamondModal() {
            diamondModal.style.display = 'flex';
        }

        // å…³é—­å¢åŠ é’»çŸ³å¼¹çª—
        function closeDiamondModal() {
            diamondModal.style.display = 'none';
        }

        // å…³é—­å¥–åŠ±å¼¹çª—
        function closeRewardModal() {
            rewardModal.style.display = 'none';
        }

        // å…³é—­æŠ½å¥–å¼¹çª—
        function closeLotteryModal() {
            lotteryModal.style.display = 'none';
        }

        // æ˜¾ç¤ºå¥–åŠ±å¼¹çª—
        function showReward(title, description) {
            rewardTitle.textContent = title;
            rewardDesc.textContent = description;
            rewardModal.style.display = 'flex';
        }

        // æ›´æ–°è´§å¸æ•°é‡æ˜¾ç¤º
        function updateCurrencyCount() {
            gemCountElement.textContent = gameState.gems;
            diamondCountElement.textContent = gameState.diamonds;
            
            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            updateButtonState();
        }

        // æ›´æ–°æŒ‰é’®çŠ¶æ€ï¼ˆå®çŸ³ä¸è¶³æ—¶ç¦ç”¨ï¼‰
        function updateButtonState() {
            summonOneBtn.disabled = gameState.gems < 2;
            summonTenBtn.disabled = gameState.gems < 20;
        }

        // æ›´æ–°è¿çº¿è¿›åº¦
        function updateProgress() {
            const progress = Math.min(gameState.lineCount, 5);
            progressText.textContent = `${progress}/5`;
            progressFill.style.width = `${(progress / 5) * 100}%`;
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–æ¸¸æˆ
        document.addEventListener('DOMContentLoaded', initGame);
        
        // é˜²æ­¢åŒå‡»ç¼©æ”¾
        let lastTouchEnd = 0;
        document.addEventListener('touchend', function(event) {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);
        
        // ç¦æ­¢åŒæŒ‡ç¼©æ”¾
        document.addEventListener('gesturestart', function(event) {
            event.preventDefault();
        });
    </script>
</body>
</html>
